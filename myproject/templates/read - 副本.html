{% extends "base.html" %}

{% block css %}
    <link rel="stylesheet" href="../static/css/read.css">
{% endblock %}

{% block script_top %}

{% endblock %}


{% block script %}
    var status={{status|safe}};
    if(status=='notread')
        {alert('读入失败！你没有文章浏览记录');}
    else{
        $(".send").click(function(){

                var user = $.cookie('user_id');//获取用户id
                var id = {{article_id_json|safe}};
                var content = $("#text").val();//获取评论内容
                console.log('user:',user)
                console.log('content:',content)
        $.ajax({
				url: '/ajax',
                dataType: "json",
				data: {
                    'user_id':user_id,
                    'content':content,
                    'id':id
				},
				success: function(data){
                    $(".comment").append(("<p>"+data[1]+"</p>"));
                    $(".comment").append(("<p>"+data[0]+"</p>"));//不刷新页面写入评论内容
                    var avatar = "<img>";
                    $(".comment").append(avatar);
                    $("img").attr('src',data[2]);//data[2]为图像路径
                    $("img").attr('style',"height:20px;width:20px;");//改变图像格式
				},
				error: function(){
					alert('出错！')
				}
                })
        });//结束发送评论按键事件
        //点击作者查看个人空间
        $(".username").click(function(){
            var user_id = $(this).children().attr('class');
            var Visitor_id= $.cookie('user_id');
            $.ajax({
				url: '/others_space',
				data: {
                    'user_id':user_id,
                    'Visitor_id':Visitor_id
				},
                success: function(data){

                    location.href="/others_space/?user_id="+user_id+"&Visitor_id="+Visitor_id;//向地址传参数
				},
				error: function(){
				},

                })
        });
        }//结束else
{% endblock %}

{% block content %}
    <div class="background2">

        <h class="title"> {{article.title}} </h>

        <div class="username">
            <a class={{article.account.id}} >{{article.account.username}}</a>
        </div>
        <h>标签:</h>
        {%for tag in tags_list%}
        <div1>{{tag.name}}</div1>
        {%endfor%}
        <div3>{{article.pub_datb}}</div3>
        <p>{{ article.content }}</p>
        <h>阅读数：</h>
        <h>{{ article.read_count }}</h>
        <h>评论数：</h>
        <h>{{comment_count}}</h>
        <h>评论区：</h>
        {%for comment in comment_list%}
        <div>
            <p class="content">{{comment.content}}</p>
            <p class="Commentator">{{comment.account}}</p>
            <img src="{{comment.account.avatar.avatar.url}}" style="height:20px;width:20px;"alt="404">
        </div>
        {%endfor%}
        <div class="comment"></div>
    </div>
    <div class="pagination">
        <ul>
            <li>
                {% if obj.number == 1 %} {# 判断当前页码是否为第一页，如果为第一页，则禁止点击 #}
                    <a aria-label="Previous">
                    <span aria-hidden="true">&laquo;</span>
                    </a>
                {% else %}
                    <a href="?page={{ obj.previous_page_number }}" aria-label="Previous">
                    <span aria-hidden="true">&laquo;</span>
                    </a>
                {% endif %}

            </li>
            {% for num in page_num %}
                {% if num == obj.number %} {# 判断是否是当前页，如果是则激活高亮显示 #}
                    <li><a href="?page={{ num }}">{{ num }}</a></li>
                {% else %}
                    <li><a href="?page={{ num }}">{{ num }}</a></li>
                {% endif %}
            {% endfor %}
            <li>
                {% if not obj.has_next %} {# 判断是否有下一页，如果没有下一页，则禁止点击 #}
                    <a aria-label="Next">
                    <span aria-hidden="true">&raquo;</span>
                    </a>
                {% else %}
                    <a href="?page={{ obj.next_page_number }}" aria-label="Next">
                    <span aria-hidden="true">&raquo;</span>
                    </a>
                {% endif %}

            </li>
        </ul>
    </div>

    <div>

            {% csrf_token %}
            <textarea type="text" id="text"></textarea>
            <button class="send" value="发送">发送</button>

    </div>
    <div style="height:500px;"></div>
{% endblock %}